<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body { font-family: sans-serif; background: #1a1a1a; color: white; text-align: center; margin: 0; padding: 20px; }
        #game-container { border: 2px solid #333; border-radius: 15px; padding: 20px; height: 300px; position: relative; overflow: hidden; background: #000; }
        #multiplier { font-size: 48px; font-weight: bold; margin-top: 80px; transition: color 0.2s; }
        #rocket { font-size: 50px; position: absolute; bottom: 20px; left: 20px; transition: all 0.1s linear; }
        .btn { background: #0088cc; border: none; padding: 15px 30px; color: white; border-radius: 10px; font-size: 18px; cursor: pointer; margin-top: 20px; width: 100%; }
        .btn:disabled { background: #555; }
        #status { color: #aaa; margin-top: 10px; }
    </style>
</head>
<body>
    <h2>üöÄ CRASH GAME</h2>
    <div id="game-container">
        <div id="multiplier">1.00x</div>
        <div id="rocket">üöÄ</div>
    </div>
    
    <input type="number" id="betInput" placeholder="–°—Ç–∞–≤–∫–∞" style="width: 80%; padding: 10px; margin-top: 20px; border-radius: 5px;">
    <button id="actionBtn" class="btn" onclick="handleAction()">–ü–û–°–¢–ê–í–ò–¢–¨</button>
    <div id="status">–ë–∞–ª–∞–Ω—Å: <span id="balance">–ó–∞–≥—Ä—É–∑–∫–∞...</span></div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand(); // –†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω

        let multiplier = 1.0;
        let isRunning = false;
        let bet = 0;
        let crashPoint = 0;
        let animationId;

        // –≠–ª–µ–º–µ–Ω—Ç—ã
        const multDisplay = document.getElementById('multiplier');
        const rocket = document.getElementById('rocket');
        const btn = document.getElementById('actionBtn');

        function startInGame() {
            bet = parseFloat(document.getElementById('betInput').value);
            if (!bet || bet <= 0) return alert("–í–≤–µ–¥–∏—Ç–µ —Å—Ç–∞–≤–∫—É!");

            isRunning = true;
            multiplier = 1.0;
            crashPoint = (Math.random() * 4 + 1).toFixed(2); // –†–∞–Ω–¥–æ–º –æ—Ç 1 –¥–æ 5
            btn.innerText = "–ó–ê–ë–†–ê–¢–¨";
            btn.style.background = "#ffcc00";
            btn.style.color = "#000";
            
            animate();
        }

        function animate() {
            if (!isRunning) return;

            multiplier += 0.01 * (1 + multiplier * 0.05);
            multDisplay.innerText = multiplier.toFixed(2) + "x";
            
            // –î–≤–∏–∂–µ–Ω–∏–µ —Ä–∞–∫–µ—Ç—ã
            let x = (multiplier - 1) * 50;
            let y = (multiplier - 1) * 30;
            rocket.style.transform = `translate(${x}px, -${y}px)`;

            if (multiplier >= crashPoint) {
                crash();
            } else {
                animationId = requestAnimationFrame(animate);
            }
        }

        function crash() {
            isRunning = false;
            cancelAnimationFrame(animationId);
            multDisplay.innerText = "–ö–†–ê–®! " + multiplier.toFixed(2) + "x";
            multDisplay.style.color = "#ff3b30";
            rocket.innerText = "üí•";
            btn.innerText = "–ü–†–û–ò–ì–†–´–®";
            btn.disabled = true;
            
            setTimeout(resetGame, 2000);
        }

        function cashOut() {
            if (!isRunning) return;
            isRunning = false;
            cancelAnimationFrame(animationId);
            const win = (bet * multiplier).toFixed(2);
            alert(`–í–´–ò–ì–†–´–®: ${win}!`);
            
            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –±–æ—Ç—É
            tg.sendData(JSON.stringify({
                action: "win",
                amount: win,
                mult: multiplier.toFixed(2)
            }));
            
            resetGame();
        }

        function resetGame() {
            isRunning = false;
            multiplier = 1.0;
            multDisplay.innerText = "1.00x";
            multDisplay.style.color = "white";
            rocket.style.transform = `translate(0, 0)`;
            rocket.innerText = "üöÄ";
            btn.innerText = "–ü–û–°–¢–ê–í–ò–¢–¨";
            btn.disabled = false;
            btn.style.background = "#0088cc";
            btn.style.color = "white";
        }

        function handleAction() {
            if (!isRunning) startInGame();
            else cashOut();
        }
    </script>
</body>
</html>